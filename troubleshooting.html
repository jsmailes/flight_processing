

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Troubleshooting &mdash; Flight Processing  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="flight_processing.data.AirspaceGraph" href="flight_processing.data.AirspaceGraph.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Flight Processing
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_structure.html">Core Structure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#i-m-trying-to-prepare-my-own-dataset-what-columns-are-needed-in-the-dataframe">I’m trying to prepare my own dataset. What columns are needed in the dataframe?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#processing-data-using-graphbuilder-is-quite-slow">Processing data using GraphBuilder is quite slow!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-confidence-results-returned-by-airspacegraph-don-t-seem-right">The confidence results returned by AirspaceGraph don’t seem right!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-need-more-precise-airspace-height-data">I need more precise airspace height data.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-have-another-question">I have another question.</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Flight Processing</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Troubleshooting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/troubleshooting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>I’ve documented some common problems/queries about this library and their potential solutions.</p>
<div class="section" id="i-m-trying-to-prepare-my-own-dataset-what-columns-are-needed-in-the-dataframe">
<h2>I’m trying to prepare my own dataset. What columns are needed in the dataframe?<a class="headerlink" href="#i-m-trying-to-prepare-my-own-dataset-what-columns-are-needed-in-the-dataframe" title="Permalink to this headline">¶</a></h2>
<p>If importing from a file, the data must be saved as a JSON representation of a geopandas GeoDataFrame, with the following columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: name of the airspace. Type <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lower_limit</span></code>: lower vertical limit of the airspace, in ft. Type <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">upper_limit</span></code>: upper vertical limit of the airspace, in ft. Type <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geometry</span></code>: lateral bounds of the airspace, given as a <code class="docutils literal notranslate"><span class="pre">Shapely.MultiPolygon</span></code> with coordinates in long-lat WGS84.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wkt</span></code>: well-known text representation of the geometry representing the lateral bounds of the airspace. Type <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p></li>
</ul>
<p>A <code class="docutils literal notranslate"><span class="pre">geometry</span></code> can be converted to a <code class="docutils literal notranslate"><span class="pre">wkt</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wkt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">wkt</span><span class="p">)</span>
</pre></div>
</div>
<p>And vice versa:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">wkt</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">shapely</span><span class="o">.</span><span class="n">wkt</span><span class="o">.</span><span class="n">loads</span><span class="p">)</span>
</pre></div>
</div>
<p>A geodataframe can be saved to file as follows, using <a class="reference external" href="flight_processing.DataConfig.html">flight_processing.DataConfig</a> to get the location:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">DataConfig</span><span class="o">.</span><span class="n">known_dataset</span><span class="p">(</span><span class="s2">&quot;usa&quot;</span><span class="p">)</span>
<span class="c1"># or: config = DataConfig(&quot;custom_name&quot;, minlon, maxlon, minlat, maxlat)</span>
<span class="n">out_location</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">dataset_location</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">out_location</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If instead the dataframe is being passed into the constructor directly (only compatible with <a class="reference external" href="flight_processing.data.GraphBuilder.html#flight_processing.data.GraphBuilder.from_dataframe">GraphBuilder.from_dataframe</a> or <a class="reference external" href="flight_processing.data.AirspaceGraph.html#flight_processing.data.AirspaceGraph.__init__">AirspaceGraph.__init__</a>), then both pandas DataFrames and geopandas GeoDataFrames are accepted.
They require the same columns as before, but DataFrames do not need the <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column and GeoDataFrames do not need the <code class="docutils literal notranslate"><span class="pre">wkt</span></code> column.</p>
</div>
<div class="section" id="processing-data-using-graphbuilder-is-quite-slow">
<h2>Processing data using GraphBuilder is quite slow!<a class="headerlink" href="#processing-data-using-graphbuilder-is-quite-slow" title="Permalink to this headline">¶</a></h2>
<p>This isn’t too surprising - flight data is quite high resolution and a lot of airspaces are being checked.
It is expected that processing will take a while, especially on larger datasets or large numbers of flights.</p>
<p>Potential solutions include:</p>
<ul class="simple">
<li><p>Downsample the airspace geometry data stored in the saved dataframe. This can be achieved using Shapely’s built-in <a class="reference external" href="https://shapely.readthedocs.io/en/stable/manual.html#object.simplify">simplify</a> method, which reduces the detail of shapes while keeping the coordinates within a certain distance of the original geometry. This will speed up airspace membership calculations without sacrificing too much accuracy.</p></li>
<li><p>Run a processing script on multiple threads using <code class="docutils literal notranslate"><span class="pre">xargs</span> <span class="pre">-n</span> <span class="pre">1</span> <span class="pre">-P</span> <span class="pre">&lt;number_of_threads&gt;</span></code>, <a class="reference external" href="http://www.gnu.org/software/parallel/">GNU Parallel</a>, or a Python multithreading library..</p></li>
<li><p>When preparing the dataframe of airspaces, combine rows with the same name into a single row with a single geometry. This will reduce the number of airspaces which need processing.</p></li>
</ul>
</div>
<div class="section" id="the-confidence-results-returned-by-airspacegraph-don-t-seem-right">
<h2>The confidence results returned by AirspaceGraph don’t seem right!<a class="headerlink" href="#the-confidence-results-returned-by-airspacegraph-don-t-seem-right" title="Permalink to this headline">¶</a></h2>
<p>I’m no data scientist, and the coefficients used to calculate the handover confidence were only designed to be placeholders for testing.
You should use the <a class="reference external" href="flight_processing.data.AirspaceGraph.html#flight_processing.data.AirspaceGraph.set_confidence_values">set_confidence_values</a> method to set these coefficients based on your analysis.</p>
<p>Alternatively you can take the values returned by <a class="reference external" href="flight_processing.data.AirspaceGraph.html#flight_processing.data.AirspaceGraph.test_point">test_point</a>, <a class="reference external" href="flight_processing.data.AirspaceGraph.html#flight_processing.data.AirspaceGraph.test_handover">test_handover</a>, and <a class="reference external" href="flight_processing.data.AirspaceGraph.html#flight_processing.data.AirspaceGraph.test_flight">test_flight</a>, and compute your own confidence value.</p>
<p>Any other issues may be caused by a lack of processed data - try processing more flights.</p>
</div>
<div class="section" id="i-need-more-precise-airspace-height-data">
<h2>I need more precise airspace height data.<a class="headerlink" href="#i-need-more-precise-airspace-height-data" title="Permalink to this headline">¶</a></h2>
<p>Currently the library assumes the airspace vertical bounds are given in the same format as the altitude of the flights being processed.
If this is not the case, or if you need to more precisely define the bounds, there are two approaches you could take:</p>
<ul class="simple">
<li><p>Split the relevant airspaces into multiple rows in the dataframe, with each row having specific vertical bounds according to your needs. Once this is done and the graph has been processed merge the relevant nodes of the graph into a single node.</p></li>
<li><p>Modify the source file <code class="docutils literal notranslate"><span class="pre">src/airspace.cpp</span></code> and change the behaviour of <code class="docutils literal notranslate"><span class="pre">MultiAirspace::process_flight</span></code> or <code class="docutils literal notranslate"><span class="pre">AirspaceBoost::inside_height</span></code> to have the desired behaviour.</p></li>
</ul>
</div>
<div class="section" id="i-have-another-question">
<h2>I have another question.<a class="headerlink" href="#i-have-another-question" title="Permalink to this headline">¶</a></h2>
<p>If there’s an issue with the library beyond what is documented here, contact me on GitHub or <a class="reference external" href="https://github.com/jsmailes/flight_processing/issues/new">create an issue</a> on the repository.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="flight_processing.data.AirspaceGraph.html" class="btn btn-neutral float-left" title="flight_processing.data.AirspaceGraph" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Joshua Smailes

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>